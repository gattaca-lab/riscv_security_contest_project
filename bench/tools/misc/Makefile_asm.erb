include <%= ENV['TOOLS_DISTRIB'] %>/share/testsMakefile.include

CC         = $(RISCV_CC)
OBJCOPY    = $(RISCV_OBJCOPY)
# YES, we support M instructions in assembly tests
CFLAGS     = $(RISCV_CFLAGS_COMMON) -march=rv32im  -mabi=ilp32
LDFLAGS    = $(RISCV_LDFLAGS_COMMON)
LDSCRIPT   = $(RISCV_ASM_LD_SCRIPT)

SRC  = <%= input_asm %>

.PHONY : all

all: test.elf test.v

test.elf: asm_pre.s
	$(CC) -Xlinker -T$(RISCV_ASM_LD_SCRIPT) $(CFLAGS) asm_pre.s -o test.elf

asm_pre.s: $(SRC)
	$(CC) -x c -E $(CFLAGS) $(SRC) -o asm_pre.s

test.v: test.elf
	$(OBJCOPY) --target verilog test.elf test.v
